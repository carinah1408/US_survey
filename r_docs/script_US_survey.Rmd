---
title: "script_US_survey"
author: "CH"
date: "28/11/2020"
output: html_document
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE)
# packages ####
library(here) # find relative path
library(readr) # read dataset
library(tidyverse) # data wrangling
library(dplyr) # data wrangling
library(remotes) # for downloading packages not on CRAN
library(Routliers) # outlier detection
library(psych) # normality, reliability
library(lavaan) # CFA
library(ggplot2) # graphs
library(MVN) # assumption check CFA

# dataset ####
data <- here::here("data/US_data.csv")

US_data <- readr::read_csv(data) %>%
  as_tibble() 

US_data$time <- factor(US_data$time)
US_data$unexp <- factor(US_data$unexp)
US_data$vote <- factor(US_data$vote)
US_data <- US_data %>%
  mutate(vote = case_when(
  vote=='1' ~ 'Democrats',
  vote=='2' ~ 'Republicans',
  TRUE ~ 'Other'))
```

# Data inspection ####

# boxplots 
```{r boxplots, include=TRUE}

# cn

box_cn_1 <- boxplot(US_data$cn_1) # "American people deserve special treatment."
# 1 outlier in cn_1

box_cn_2 <- boxplot (US_data$cn_2) # "I will never be satisfied until American people get all they deserve."
box_cn_3 <- boxplot(US_data$cn_3) # "It really makes me angry when others criticize American people."
box_cn_4 <- boxplot(US_data$cn_4) # "If American people had a major say in the world, the world would be a much better place."
box_cn_5 <- boxplot(US_data$cn_5) # "Not many people seem to fully understand the importance of American people."

# secident

box_secident_1 <- boxplot(US_data$secident_1) # "I feel a bond with Americans."
box_secident_2 <- boxplot(US_data$secident_2) # "I feel solidarity with Americans."
box_secident_3 <- boxplot(US_data$secident_3) # "I feel committed to Americans."
box_secident_4 <- boxplot(US_data$secident_4) # "I am glad to be American."
box_secident_5 <- boxplot(US_data$secident_5) # "I think that Americans have a lot to be proud of."
box_secident_6 <- boxplot(US_data$secident_6) # "It is pleasant to be American."
box_secident_7 <- boxplot(US_data$secident_7) # "Being American gives me a good feeling."
box_secident_8 <- boxplot(US_data$secident_8) # "I often think about the fact that I am American."
box_secident_9 <- boxplot(US_data$secident_9) # "The fact that I am American is an important part of my identity."
box_secident_10 <- boxplot(US_data$secident_10) # "Being American is an important part of how I see myself."
# Striking is that items secident _7 to _10 show the same boxplot. I checked the raw data to make sure that the values were not accidently doublicated and copy-pasted but the items are unique in values, yet similar to each other in expression. Potentially colinear? ####

# xeno

box_xeno_1 <- boxplot(US_data$xeno_1) # "It would be ok for me if my child married a person of color."
box_xeno_2 <- boxplot(US_data$xeno_2) # "It would be ok for me if my child married a person that immigrated to America."
box_xeno_3 <- boxplot(US_data$xeno_3) # "To be truly American you have to be White."
box_xeno_4 <- boxplot(US_data$xeno_4) # "America has benefited from diversity."
box_xeno_5 <- boxplot(US_data$xeno_5) # "When I think about the Black Lives Matter movement, I think that all lives matter."
box_xeno_6 <- boxplot(US_data$xeno_6) # "I support the Black Lives Matter movement."
# 1 outlier in xeno_1, 1 in xeno_2, 3 in xeno_3 ####

# joy

box_joy_1 <- boxplot(US_data$joy_1) # "The US presidential election 2020 makes me feel joyful."
box_joy_2 <- boxplot(US_data$joy_2) # "The US presidential election 2020 makes me feel excited."

# eff

box_eff_1 <- boxplot(US_data$eff_1) # "Thinking about the US presidential election 2020, I believe that we Americans can change society."
box_eff_2 <- boxplot(US_data$eff_2) # "Thinking about the US presidential election 2020, I believe that we Americans can realize our values."
# 1 outlier in eff_1
```

# histogram
```{r histograms, include=TRUE}
# cn 
ggplot(US_data, aes(x=cn_1))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "I will never be satisfied until American people get all they deserve.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=cn_2))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "I will never be satisfied until American people get all they deserve.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=cn_3))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "It really makes me angry when others criticize American people.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=cn_4))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "If American people had a major say in the world, the world would be a much better place.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=cn_5))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Not many people seem to fully understand the importance of American people.", y = "Frequency") +
  theme_light()


# xeno 
ggplot(US_data, aes(x=xeno_1))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "rev_It would be ok for me if my child married a person of color.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=xeno_2))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "rev_It would be ok for me if my child married a person that immigrated to America.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=xeno_3))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "To be truly American you have to be White.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=xeno_4))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "rev_America has benefited from diversity.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=xeno_5))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "When I think about the Black Lives Matter movement, I think that all lives matter.", y = "Frequency") +
  theme_light()
# potentially problematic wording!

ggplot(US_data, aes(x=xeno_6))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "rev_I support the Black Lives Matter movement.", y = "Frequency") +
  theme_light()


# secident
ggplot(US_data, aes(x=secident_1))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "I feel a bond with Americans.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=secident_2))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "I feel solidarity with Americans.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=secident_3))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "I feel committed to Americans.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=secident_4))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "I am glad to be American.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=secident_5))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "I think that Americans have a lot to be proud of.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=secident_6))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "It is pleasant to be American.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=secident_7))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Being American gives me a good feeling.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=secident_8))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "I often think about the fact that I am American.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=secident_9))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "The fact that I am American is an important part of my identity.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=secident_10))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Being American is an important part of how I see myself.", y = "Frequency") +
  theme_light()

# joy
ggplot(US_data, aes(x=joy_1))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "The US presidential election 2020 makes me feel joyful.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=joy_2))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "The US presidential election 2020 makes me feel excited.", y = "Frequency") +
  theme_light()


# eff
ggplot(US_data, aes(x=eff_1))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Thinking about the US presidential election 2020, I believe that we Americans can change society.", y = "Frequency") +
  theme_light()

ggplot(US_data, aes(x=eff_2))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Thinking about the US presidential election 2020, I believe that we Americans can realize our values.", y = "Frequency") +
  theme_light()
```

```{r histograms by group, include=TRUE}

# cn by vote
ggplot(US_data, aes(x=cn_1, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "American people deserve special treatment.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=cn_2, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I will never be satisfied until American people get all they deserve.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=cn_3, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "It really makes me angry when others criticize American people.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=cn_4, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "If American people had a major say in the world, the world would be a much better place.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=cn_5, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Not many people seem to fully understand the importance of American people.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()


# cn by time
ggplot(US_data, aes(x=cn_1, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "American people deserve special treatment.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=cn_2, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I will never be satisfied until American people get all they deserve.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=cn_3, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "It really makes me angry when others criticize American people.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=cn_4, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "If American people had a major say in the world, the world would be a much better place.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=cn_5, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Not many people seem to fully understand the importance of American people.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()


# xeno by vote
ggplot(US_data, aes(x=xeno_1, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "rev_It would be ok for me if my child married a person of color.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=xeno_2, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "rev_It would be ok for me if my child married a person that immigrated to America.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=xeno_3, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "To be truly American you have to be White.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=xeno_4, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "rev_America has benefited from diversity.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=xeno_5, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "When I think about the Black Lives Matter movement, I think that all lives matter.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=xeno_6, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "rev_I support the Black Lives Matter movement.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()


# xeno by time
ggplot(US_data, aes(x=xeno_1, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "rev_It would be ok for me if my child married a person of color.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=xeno_2, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "rev_It would be ok for me if my child married a person that immigrated to America.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=xeno_3, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "To be truly American you have to be White.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=xeno_4, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "rev_America has benefited from diversity.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=xeno_5, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "When I think about the Black Lives Matter movement, I think that all lives matter.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=xeno_6, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "rev_I support the Black Lives Matter movement.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()


# secident by vote
ggplot(US_data, aes(x=secident_1, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I feel a bond with Americans.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=secident_2, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I feel solidarity with Americans.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=secident_3, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I feel committed to Americans.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=secident_4, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I am glad to be American.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=secident_5, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I think that Americans have a lot to be proud of.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=secident_6, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "It is pleasant to be American.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=secident_7, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Being American gives me a good feeling.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=secident_8, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I often think about the fact that I am American.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=secident_9, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "The fact that I am American is an important part of my identity.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=secident_10, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Being American is an important part of how I see myself.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()


# secident by time
ggplot(US_data, aes(x=secident_1, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I feel a bond with Americans.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=secident_2, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I feel solidarity with Americans.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=secident_3, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I feel committed to Americans.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=secident_4, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I am glad to be American.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=secident_5, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I think that Americans have a lot to be proud of.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=secident_6, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "It is pleasant to be American.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=secident_7, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Being American gives me a good feeling.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=secident_8, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "I often think about the fact that I am American.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=secident_9, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "The fact that I am American is an important part of my identity.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=secident_10, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Being American is an important part of how I see myself.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()


# joy by vote
ggplot(US_data, aes(x=joy_1, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "The US presidential election 2020 makes me feel joyful.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=joy_2, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "The US presidential election 2020 makes me feel excited.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()


# joy by time
ggplot(US_data, aes(x=joy_1, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "The US presidential election 2020 makes me feel joyful.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=joy_2, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "The US presidential election 2020 makes me feel excited.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()


# eff by vote
ggplot(US_data, aes(x=eff_1, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Thinking about the US presidential election 2020, I believe that we Americans can change society.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=eff_2, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Thinking about the US presidential election 2020, I believe that we Americans can realize our values.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

# eff by time
ggplot(US_data, aes(x=eff_1, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Thinking about the US presidential election 2020, I believe that we Americans can change society.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=eff_2, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Thinking about the US presidential election 2020, I believe that we Americans can realize our values.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()
```

# outlier detection
```{r outlier detection using MAD, include = TRUE}
# cn
cn <- rowMeans(US_data[, c("cn_1", "cn_2", "cn_3", "cn_4", "cn_5")])
cn_mad <- outliers_mad(x = cn)
cn_mad


# secident
secident <- rowMeans(US_data[, c("secident_1", "secident_2", "secident_3", "secident_4", "secident_5", "secident_6", "secident_7", "secident_8", "secident_9", "secident_10")])
secident_mad <- outliers_mad(x = secident)
secident_mad

# xeno
xeno <- rowMeans(US_data[, c("xeno_1", "xeno_2", "xeno_3", "xeno_4", "xeno_5", "xeno_6")])
xeno_mad <- outliers_mad(x = xeno)
xeno_mad
plot_outliers_mad(xeno_mad, x = xeno, pos_display = TRUE)
# 6 outliers detected: the value of 2.9826 was compared with the median of xeno_1 - xeno_6 in dataset and the following ids were identified as > 2.8926: p090 t1 (xeno_1 & xeno_2), p189 (xeno_1 & xeno_2), p192 t2 (xeno_2 & xeno_3), p196 (xeno_1, xeno_2, xeno_3) ####

# joy
joy <- rowMeans(US_data[, c("joy_1", "joy_2")])
joy_mad <- outliers_mad(x = joy)
joy_mad


# eff
eff <- rowMeans(US_data[, c("eff_1", "eff_2")])
eff_mad <- outliers_mad(x = eff)
eff_mad
```


# reliability (internal consistency and Spearman rho) 
```{r, reliability, include=TRUE}
# Reliability if item is dropped (--> raw alpha)

# cn
key <- list(
  CN = c("cn_1", "cn_2", "cn_3", "cn_4", "cn_5")
)

# Cronbach´s alpha
scoreItems(key, US_data)

US_data %>%
  dplyr::select(5:9) %>%
  psych::alpha()

# cronbach´s alpha for cn = 0.84


# secident
key <- list(
  secident = c("secident_1", "secident_2", "secident_3", "secident_4", "secident_5", 
               "secident_6", "secident_7", "secident_8", "secident_9", "secident_10")
)

# Cronbach´s alpha
scoreItems(key, US_data)

US_data %>%
  dplyr::select(16:25) %>%
  psych::alpha()

# cronbach´s alpha for secident = 0.96

# xeno
key <- list(
  xeno = c("xeno_1", "xeno_2", "xeno_3", "xeno_4", "xeno_5", "xeno_6")
)

# Cronbach´s alpha
scoreItems(key, US_data)

US_data %>%
  dplyr::select(10:15) %>%
  psych::alpha()

# xeno without xeno_5 (see CFA)
key <- list(
  xeno_1 = c("xeno_1", "xeno_2", "xeno_3", "xeno_4", "xeno_6")
)

# Cronbach´s alpha
scoreItems(key, US_data)

US_data %>%
  dplyr::select(10, 11, 12, 13, 15) %>%
  psych::alpha()


# cronbach´s alpha for xeno without xeno_5 = 0.71

# xeno without xeno_5 and xeno_6 (see CFA)
key <- list(
  xeno_2 = c("xeno_1", "xeno_2", "xeno_3", "xeno_4")
)

# Cronbach´s alpha
scoreItems(key, US_data)

US_data %>%
  dplyr::select(10, 11, 12, 13) %>%
  psych::alpha()


# cronbach´s alpha for xeno without xeno_5 = 0.71

# joy (Spearman-Brown statistic)

cor.test(US_data$joy_1, US_data$joy_2,
         method = "spearman")

# Spearman rho = .69

# eff (Spearman-Brown statistic)

cor.test(US_data$eff_1, US_data$eff_2,
         method = "spearman")

# Spearman rho = .65
```

# normality test for those items, a normal distribution is expected (use ML estimation, for those items no normal distribution is expected (xenophobia), use MLR in CFA

# action required if skewness > 2, kurtosis > 7, multivariate kurtosis (Mardia´s coefficient) > 3
# psych package: describe() --> skew and kurtosis, mardia ()
```{r, normality, include=TRUE}
# cn 
describe(US_data$cn_1)
describe(US_data$cn_2)
describe(US_data$cn_3)
describe(US_data$cn_4)
describe(US_data$cn_5)

# secident
describe(US_data$secident_1)
describe(US_data$secident_2)
describe(US_data$secident_3)
describe(US_data$secident_4)
describe(US_data$secident_5)
describe(US_data$secident_6)
describe(US_data$secident_7)
describe(US_data$secident_8)
describe(US_data$secident_9)
describe(US_data$secident_10)

# xeno
describe(US_data$xeno_1)
describe(US_data$xeno_2)
describe(US_data$xeno_3)
describe(US_data$xeno_4)
describe(US_data$xeno_5)
describe(US_data$xeno_6)
# xeno_3 shows issues: use MLR in estimation since non-normality is excepted here

# joy
describe(US_data$joy_1)
describe(US_data$joy_2)

# eff
describe(US_data$eff_1)
describe(US_data$joy_2)
```


# validity (CFA) based on items that were chosen to be kept
# data has to be data matrix
```{r, cfa, include=TRUE}
# Check the results, quick check with "User Model versus
# Baseline Model," which should have values above 0.9 or
# possibly 0.95

# cn

cn.cfa <- US_data %>%
  dplyr::select(cn_1, cn_2, cn_3, cn_4, cn_5) 

mardia(cn.cfa, plot = TRUE)

keep <- function(x) {
(x >= mean(x) - 3*sd(x)) & 
(x <= mean(x) + 3*sd(x))  
}

cn.cfa_clean <- cn.cfa %>%
  filter(keep(cn_1) &
           keep(cn_2) &
           keep(cn_3) &
           keep(cn_4) &
           keep(cn_5))

cn.model <- 'CollectNar =~ cn_1 + cn_2 + cn_3 + cn_4 + cn_5'

fit_cn <- cfa(cn.model, data = cn.cfa_clean)

fit_cn %>% summary(fit.measures = TRUE, standardized = TRUE)

lavInspect(fit_cn, what = "sampstat")
lavInspect(fit_cn, what = "implied")
residual_cn <- lavInspect(fit_cn, what = "sampstat") $cov - 
  lavInspect(fit_cn, what = "implied") $cov
residual_cn

# Residual divided by an estimate of its standard error.
# If greater than 2, it is significantly different from zero.
resid(fit_cn, type = "standardized")

# xeno

xeno.cfa <- US_data %>%
  dplyr::filter(id != "p090" & id != "189" & id != "192" & id != "196") %>%
  dplyr::select(xeno_1, xeno_2, xeno_3, xeno_4, xeno_5, xeno_6)
  

# 6 outliers detected: the value of 2.9826 was compared with the median of xeno_1 - xeno_6 in dataset and the following ids were identified as > 2.8926: p090 t1 (xeno_1 & xeno_2), p189 (xeno_1 & xeno_2), p192 t2 (xeno_2 & xeno_3), p196 (xeno_1, xeno_2, xeno_3) ####


xeno.model <- 'Xenophobia =~ xeno_1 + xeno_2 + xeno_3 + xeno_4 + xeno_5 +
xeno_6'

fit_xeno <- cfa(xeno.model, data = xeno.cfa, estimator = "MLR")

fit_xeno %>% summary(fit.measures = TRUE)

lavInspect(fit_xeno, what = "sampstat")
lavInspect(fit_xeno, what = "implied")
residual_xeno <- lavInspect(fit_xeno, what = "sampstat") $cov - 
  lavInspect(fit_xeno, what = "implied") $cov
residual_xeno
resid(fit_xeno, type = "standardized")

# xeno without xeno_5

xeno2.cfa <- US_data %>%
  dplyr::filter(id != "p090" & id != "189" & id != "192" & id != "196") %>%
  dplyr::select(xeno_1, xeno_2, xeno_3, xeno_4, xeno_6)
  
xeno2.model <- 'Xenophobia =~ xeno_1 + xeno_2 + xeno_3 + xeno_4 +
xeno_6'

fit_xeno2 <- cfa(xeno2.model, data = xeno2.cfa, estimator = "MLR")

fit_xeno2 %>% summary(fit.measures = TRUE)

lavInspect(fit_xeno2, what = "sampstat")
lavInspect(fit_xeno2, what = "implied")
residual_xeno2 <- lavInspect(fit_xeno2, what = "sampstat") $cov - 
  lavInspect(fit_xeno2, what = "implied") $cov
residual_xeno2
resid(fit_xeno2, type = "standardized")

# xeno without xeno_5 and xeno_6

xeno3.cfa <- US_data %>%
  dplyr::filter(id != "p090" & id != "189" & id != "192" & id != "196") %>%
  dplyr::select(xeno_1, xeno_2, xeno_3, xeno_4)
  
xeno3.model <- 'Xenophobia =~ xeno_1 + xeno_2 + xeno_3 + xeno_4'

fit_xeno3 <- cfa(xeno3.model, data = xeno3.cfa, estimator = "MLR")

fit_xeno3 %>% summary(fit.measures = TRUE)

lavInspect(fit_xeno3, what = "sampstat")
lavInspect(fit_xeno3, what = "implied")
residual_xeno3 <- lavInspect(fit_xeno3, what = "sampstat") $cov - 
  lavInspect(fit_xeno3, what = "implied") $cov
residual_xeno3
resid(fit_xeno3, type = "standardized")

# secident is multidimensional

sec.cfa <- US_data %>%
  dplyr::select(secident_1, secident_2, secident_3, secident_4, secident_5, secident_6,
                secident_7, secident_8, secident_9, secident_10) 

mardia(sec.cfa, plot = TRUE)

keep <- function(x) {
(x >= mean(x) - 3*sd(x)) & 
(x <= mean(x) + 3*sd(x))  
}

sec.cfa_clean <- sec.cfa %>%
  filter(keep(secident_1) &
           keep(secident_2) &
           keep(secident_3) &
           keep(secident_4) &
           keep(secident_5) &
           keep(secident_6) &
           keep(secident_7) &
           keep(secident_8) &
           keep(secident_9) &
           keep(secident_10))
sec.cfa_clean

sec.model <- 'satisfac =~ secident_4 + secident_5 + secident_6 + secident_7 
              solidar =~ secident_1 + secident_2 + secident_3 
              central  =~ secident_8 + secident_9 + secident_10'

fit_secident <- cfa(sec.model, data = sec.cfa_clean)

fit_secident %>% summary(fit.measures = TRUE)

lavInspect(fit_secident, what = "sampstat")
lavInspect(fit_secident, what = "implied")
residual_secident <- lavInspect(fit_secident, what = "sampstat") $cov - 
  lavInspect(fit_secident, what = "implied") $cov
residual_secident
resid(fit_secident, type = "standardized")

# joy

joy.model <- 'Joy at Success =~ a*joy_1 + a*joy_2'

fit_joy <- cfa(joy.model, data = US_data, estimator = "ML", std.lv = TRUE)

fit_joy %>% summary(fit.measures = TRUE)

# --> fit of model is not accessible due to two-item construction

# eff

eff.model <- 'Group efficacy =~ a*eff_1 + a*eff_2'

fit_eff <- cfa(eff.model, data = US_data, estimator = "ML", std.lv = TRUE)

fit_eff %>% summary(fit.measures = TRUE)

# --> fit of model is not accessible due to two-item construction

# empowerment

emp.cfa <- US_data %>%
  dplyr::select(joy_1, joy_2, eff_1, eff_2) 

mardia(emp.cfa, plot = TRUE)

keep <- function(x) {
(x >= mean(x) - 3*sd(x)) & 
(x <= mean(x) + 3*sd(x))  
}

emp.cfa_clean <- emp.cfa %>%
  filter(keep(joy_1) &
           keep(joy_2) &
           keep(eff_1) &
           keep(eff_2))

emp.model <- 'Empowerment =~ joy_1 + joy_2 + eff_1 + eff_2'

fit_emp <- cfa(emp.model, data = emp.cfa_clean)

fit_emp %>% summary(fit.measures = TRUE)

lavInspect(fit_emp, what = "sampstat")
lavInspect(fit_emp, what = "implied")
residual_emp <- lavInspect(fit_emp, what = "sampstat") $cov - 
  lavInspect(fit_emp, what = "implied") $cov
residual_emp
resid(fit_emp, type = "standardized")

# --> overall empowerment shows low construct validity (.82)
```

# creating new variables (cn, secident, xeno, joy & eff)
```{r, new variables, include=TRUE}
US <- US_data %>%
  mutate(cn = (cn_1 + cn_2 + cn_3 + cn_4 + cn_5)/5,
        secident = (secident_1 + secident_2 + secident_3 + secident_4 + secident_5 +
        secident_6 + secident_7 + secident_8 + secident_9 + secident_10)/10,
        xeno = (xeno_1 + xeno_2 + xeno_3 + xeno_4)/4, 
        joy = (joy_1 + joy_2)/2,
        eff = (eff_1 + eff_2)/2)
psych::describe(US$cn)
psych::describe(US$secident)
psych::describe(US$xeno) # kurtosis < -1
psych::describe(US$joy) 
psych::describe(US$eff)
# for further analyses with xeno, use non-parametric tools

ggplot(US, aes(x=cn))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Collective Narcissism", y = "Frequency") +
  theme_light()

ggplot(US, aes(x=secident))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Secure Ingroup Identity", y = "Frequency") +
  theme_light()

ggplot(US, aes(x=xeno))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Xenophobia", y = "Frequency") +
  theme_light()

ggplot(US, aes(x=joy))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Joy at Success", y = "Frequency") +
  theme_light()

ggplot(US, aes(x=eff))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Group Efficacy", y = "Frequency") +
  theme_light()

# cn
cn <- rowMeans(US[,"cn"])
cn_mad <- outliers_mad(x = cn)
cn_mad

# secident
secident <- rowMeans(US[,"secident"])
secident_mad <- outliers_mad(x = secident)
secident_mad

# xeno
xeno <- rowMeans(US[,"xeno"])
xeno_mad <- outliers_mad(x = xeno)
xeno_mad
# 121 outliers (extremly high)

# joy
joy <- rowMeans(US[,"joy"])
joy_mad <- outliers_mad(x = joy)
joy_mad

# eff
eff <- rowMeans(US[,"eff"])
eff_mad <- outliers_mad(x = eff)
eff_mad
```

# acquiescent responding
```{r, acquiescent responding}
cor.test(US_data$xeno_3, US_data$xeno_4,
         method = "spearman")

cor.test(US_data$xeno_5, US_data$xeno_6,
         method = "spearman")
```


# assumption checks for PI, FC & corona (do not sum!) items
```{r, assumption checks PI, FC, corona}
# pi_own
psych::describe(US$pi_1_own)
psych::describe(US$pi_2_own)

ggplot(US, aes(x=pi_1_own))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "How comfortable would you feel with carrying a weapon if you lived in a diverse neighborhood?", y = "Frequency") +
  theme_light()

ggplot(US, aes(x=pi_2_own))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "How comfortable would you feel with doing whatever it takes to protect yourself and other Americans?", y = "Frequency") +
  theme_light()

# pi_own by vote
ggplot(US_data, aes(x=pi_1_own, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How comfortable would you feel with carrying a weapon if you lived in a diverse neighborhood?", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=pi_2_own, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How comfortable would you feel with doing whatever it takes to protect yourself and other Americans?", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

# pi_own by vote and time
ggplot(US_data, aes(x=pi_1_own, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How comfortable would you feel with carrying a weapon if you lived in a diverse neighborhood?", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=pi_2_own, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How comfortable would you feel with doing whatever it takes to protect yourself and other Americans?", y= "Frequency") +
  scale_fill_manual(name = "Time",
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

# pi_ave
ggplot(US, aes(x=pi_1_ave))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "How comfortable would the average American feel with carrying a weapon if they lived in a diverse neighborhood?", y = "Frequency") +
  theme_light()

ggplot(US, aes(x=pi_2_ave))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "How comfortable would the average American with doing whatever it takes to protect themselves and other Americans?", y = "Frequency") +
  theme_light()

# pi_ave by vote
ggplot(US_data, aes(x=pi_1_ave, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How comfortable would the average American feel with carrying a weapon if they lived in a diverse neighborhood?", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=pi_2_ave, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How comfortable would the average American with doing whatever it takes to protect themselves and other Americans?", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

# pi_ave by vote and time
ggplot(US_data, aes(x=pi_1_ave, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How comfortable would the average American feel with carrying a weapon if they lived in a diverse neighborhood?", y= "Frequency") +
  scale_fill_manual(name = "Time",
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=pi_2_ave, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How comfortable would the average American with doing whatever it takes to protect themselves and other Americans?", y= "Frequency") +
  scale_fill_manual(name = "Time",
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

# fc
psych::describe(US$fc_1_s)
psych::describe(US$fc_1_o_agr)
psych::describe(US$fc_2_s) # kurtosis > 1
psych::describe(US$fc_2_o_agr)

# fc_s
ggplot(US, aes(x=fc_1_s))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Harsh measures against immigrants and refugees are necessary.", y = "Frequency") +
  theme_light()

ggplot(US, aes(x=fc_2_s))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Social policies, such as affirmative action, discriminate unfairly against White people.", y = "Frequency") +
  theme_light()

# fc_s by vote
ggplot(US_data, aes(x=fc_1_s, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Harsh measures against immigrants and refugees are necessary.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=fc_2_s, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Social policies, such as affirmative action, discriminate unfairly against White people.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

# fc_s by vote and time
ggplot(US_data, aes(x=fc_1_s, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Harsh measures against immigrants and refugees are necessary.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=fc_2_s, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Social policies, such as affirmative action, discriminate unfairly against White people.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

# fc_other_agree
ggplot(US, aes(x=fc_1_o_agr))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Others agree: Harsh measures against immigrants and refugees are necessary.", y = "Frequency") +
  theme_light()

ggplot(US, aes(x=fc_2_o_agr))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "Others agree: Social policies, such as affirmative action, discriminate unfairly against White people.", y = "Frequency") +
  theme_light()

# fc_other_agree by vote
ggplot(US_data, aes(x=fc_1_o_agr, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Others agree: Harsh measures against immigrants and refugees are necessary.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

ggplot(US_data, aes(x=fc_2_o_agr, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Others agree: Social policies, such as affirmative action, discriminate unfairly against White people.", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

# fc_other_agree by vote and time
ggplot(US_data, aes(x=fc_1_o_agr, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Others agree: Harsh measures against immigrants and refugees are necessary.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

ggplot(US_data, aes(x=fc_2_o_agr, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "Others agree: Social policies, such as affirmative action, discriminate unfairly against White people.", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

# corona

psych::describe(US$cor_health)
psych::describe(US$cor_values)

# cor health
ggplot(US, aes(x=cor_health))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "How much of a threat, if any, is the coronavirus outbreak for the health of the U.S. population as a whole?", y = "Frequency") +
  theme_light()

# cor health by vote
ggplot(US_data, aes(x=cor_health, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How much of a threat, if any, is the coronavirus outbreak for the health of the U.S. population as a whole?", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

# cor health by vote and time

ggplot(US_data, aes(x=cor_health, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How much of a threat, if any, is the coronavirus outbreak for the health of the U.S. population as a whole?", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()

# cor values
ggplot(US, aes(x=cor_values))+
  stat_bin(colour="grey",fill="steelblue", geom = "bar") +
  labs(x = "How much of a threat, if any, is the coronavirus outbreak for American values and traditions?", y = "Frequency") +
  theme_light()

# cor values by vote
ggplot(US_data, aes(x=cor_values, fill=vote))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How much of a threat, if any, is the coronavirus outbreak for American values and traditions?", y= "Frequency") +
  scale_fill_manual(name = "Vote", 
      labels = c("Democratic Party", "Republican Party", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  theme_light()

# cor values by vote and time
ggplot(US_data, aes(x=cor_values, fill=time))+
  geom_histogram(aes(y=..density..),binwidth=1, alpha=.5, position="identity") +
  labs(x= "How much of a threat, if any, is the coronavirus outbreak for American values and traditions?", y= "Frequency") +
  scale_fill_manual(name = "Time", 
      labels = c("Before election", "After election", NA), 
      values = c("#58a6a6", "#efa355", NA)) +
  facet_wrap(vars(vote), scales = "free_y", nrow = 2, strip.position = "top") +
  theme_light()
```

# outlier detection
```{r, outlier detection}
# pi_own
pi <- rowMeans(US[,"pi_1_own"])
pi_mad <- outliers_mad(x = pi)
pi_mad

pi2 <- rowMeans(US[,"pi_2_own"])
pi2_mad <- outliers_mad(x = pi2)
pi2_mad

# pi_ave
pi3 <- rowMeans(US[,"pi_1_ave"])
pi3_mad <- outliers_mad(x = pi3)
pi3_mad

pi4 <- rowMeans(US[,"pi_2_ave"])
pi4_mad <- outliers_mad(x = pi4)
pi4_mad

# fc_s
fc <- rowMeans(US[,"fc_1_s"])
fc_mad <- outliers_mad(x = fc)
fc_mad
# 9 outlier

# the value 6.4478 was compared with fc_1_s in raw dataset and the following outlier detected: p022 t1 & t2, p079 t2, p101 t1, p140 t1, p156 t1 &t2, p167 t1, p192 t2

fc2 <- rowMeans(US[,"fc_2_s"])
fc2_mad <- outliers_mad(x = fc2)
fc2_mad

# fc_other_agree
fc3 <- rowMeans(US[,"fc_1_o_agr"])
fc3_mad <- outliers_mad(x = fc3)
fc3_mad
# 2 outlier

# the value 15.522 was compared with fc_1_o_agr in raw dataset and the following outlier detected: p160 t1 & t2 

fc4 <- rowMeans(US[,"fc_2_o_agr"])
fc4_mad <- outliers_mad(x = fc4)
fc4_mad

# cor_health
cor <- rowMeans(US[,"cor_health"])
cor_mad <- outliers_mad(x = cor)
cor_mad
# 122 outliers (low)

# cor_values
cor2 <- rowMeans(US[,"cor_values"])
cor2_mad <- outliers_mad(x = cor2)
cor2_mad
```

# descriptive statistics
```{r, frequencies}
US_data %>% 
  select(vote) %>%
  table()
```

```{r, continous, grouped}

```

